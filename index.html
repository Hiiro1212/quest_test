<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãŸã³ã³ã¨ãŸã¡ã®ã•ã‹ã°</title>
    <style>
        /* --- åŸºæœ¬è¨­å®š --- */
        body {
            margin: 0;
            padding: 0;
            font-family: "Helvetica Neue", Arial, sans-serif;
            color: #e0e0e0;
            background-color: #0d0d0d;
            overflow-x: hidden;
            text-shadow: 0 0 4px rgba(255, 255, 255, 0.3);
        }

        /* --- èƒŒæ™¯ç”»åƒã®å‡¦ç† --- */
        .bg-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            overflow: hidden;
        }
        .bg-image {
            width: 100%;
            height: 100%;
            background-image: url('1.png'); 
            background-size: cover;
            background-position: center;
            transform: scale(1.1) translateY(2%);
            filter: blur(3px) brightness(0.35);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        header {
            text-align: center;
            margin-bottom: 60px;
        }
        .site-logo {
            max-width: 800px;
            width: 90%;
            height: auto;
            filter: drop-shadow(0 0 10px rgba(0,0,0,0.8));
            display: block;
            margin: 0 auto;
        }

        /* --- ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ (5åˆ—è¡¨ç¤º) --- */
        .main-menu {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            max-width: 1300px;
            margin: 0 auto;
            padding: 20px;
        }
        @media (max-width: 1100px) {
            .main-menu { grid-template-columns: repeat(3, 1fr); }
        }
        @media (max-width: 700px) {
            .main-menu { grid-template-columns: repeat(2, 1fr); }
        }

        .menu-item { text-align: center; cursor: pointer; transition: transform 0.3s; }
        .menu-item:hover { transform: scale(1.1); }
        .icon-bg {
            background-color: rgba(0, 0, 0, 0.6); border-radius: 20px; padding: 15px;
            box-shadow: 0 0 20px rgba(0,0,0,0.8); border: 1px solid #444; transition: border-color 0.3s;
        }
        .menu-item:hover .icon-bg { border-color: #ffcc66; }
        .menu-icon { width: 100%; max-width: 100px; height: auto; display: block; margin: 0 auto; }
        .menu-label {
            margin-top: 15px; font-size: 1rem; color: #ffcc66; font-weight: bold;
            line-height: 1.4; text-shadow: 0 0 8px rgba(255, 204, 102, 0.7);
        }

        /* --- å„ç”»é¢å…±é€š --- */
        .sub-screen {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100vh;
            z-index: 200; overflow-y: auto; background-color: #000; padding-bottom: 50px;
        }
        .screen-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover; background-position: center; z-index: -1; filter: brightness(0.5);
        }
        #tarot-screen .screen-bg { background-image: url('tarot_bg.png'); }
        #search-screen .screen-bg { background-image: url('search_bg.png'); }
        #book-screen .screen-bg { background-image: url('book_bg.png'); }
        #lobby-screen .screen-bg { background-image: url('lobby_bg.png'); }
        #bag-screen .screen-bg { background-image: url('bag_bg.png'); }

        /* å·¦ä¸ŠãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ (å›ºå®š) */
        .nav-header {
            position: fixed; top: 20px; left: 20px; z-index: 300; display: flex; gap: 10px;
        }
        .nav-btn {
            padding: 8px 16px; background: rgba(0,0,0,0.8); color: #fff; border: 1px solid #ffcc66;
            border-radius: 5px; cursor: pointer; font-size: 0.9rem; transition: 0.2s;
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
        }
        .nav-btn:hover { background: #ffcc66; color: #000; }

        /* å³ä¸Šæ™‚è¨ˆ (å›ºå®š) */
        .clock-display {
            position: fixed; top: 20px; right: 20px; z-index: 300;
            color: #ffcc66; font-size: 1.5rem; font-weight: bold; font-family: monospace;
            text-shadow: 0 0 5px #000, 0 0 10px rgba(255, 204, 102, 0.5);
            background: rgba(0,0,0,0.4); padding: 5px 15px; border-radius: 10px; border: 1px solid #444;
        }

        /* --- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ©Ÿèƒ½ --- */
        .profile-trigger {
            /* ä½ç½®èª¿æ•´: å·¦ä¸Šã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã‹ã¶ã‚‰ãªã„ã‚ˆã†ã«å°‘ã—ä¸‹ã¸ */
            position: fixed; top: 80px; left: 20px; z-index: 300;
            width: 60px; height: 60px; cursor: pointer; transition: transform 0.2s;
        }
        .profile-trigger:hover { transform: scale(1.1); }
        .profile-icon-img {
            width: 100%; height: 100%; border-radius: 50%; object-fit: cover;
            border: 3px solid #444; background: #000; box-shadow: 0 0 10px rgba(0,0,0,0.8);
        }
        /* ãƒ•ãƒ¬ãƒ¼ãƒ ã‚¹ã‚¿ã‚¤ãƒ« */
        .frame-normal { border: 3px solid #666; }
        .frame-silver { border: 3px solid #c0c0c0; box-shadow: 0 0 10px #c0c0c0; }
        .frame-gold { border: 3px solid #ffd700; box-shadow: 0 0 10px #ffd700; }

        /* ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); z-index: 1000; align-items: center; justify-content: center;
        }
        .modal-content {
            background: rgba(20,20,20,0.95); border: 2px solid #ffcc66; border-radius: 15px;
            padding: 30px; width: 500px; max-width: 90%; color: #eee; position: relative;
            box-shadow: 0 0 30px rgba(0,0,0,0.8); max-height: 90vh; overflow-y: auto;
        }
        .modal-close {
            position: absolute; top: 15px; right: 20px; font-size: 1.5rem; cursor: pointer; color: #888;
        }
        .modal-close:hover { color: #fff; }
        .profile-section { margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 20px; }
        
        /* ãƒ¬ãƒ™ãƒ«ãƒ»XPãƒãƒ¼ã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
        .level-container { text-align: center; margin-bottom: 20px; }
        .level-text { font-size: 1.5rem; color: #ffcc66; font-weight: bold; }
        .xp-bar-container {
            width: 100%; height: 20px; background-color: #333; border: 1px solid #555;
            border-radius: 10px; margin-top: 5px; position: relative; overflow: hidden;
        }
        .xp-bar-fill {
            height: 100%; background-color: #4caf50; width: 0%; transition: width 0.5s ease-out;
        }
        .xp-bar-text {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
            font-size: 0.8rem; color: #fff; text-shadow: 0 0 3px #000; font-weight: bold;
        }
        
        .tag-selector {
            display: flex; flex-wrap: wrap; gap: 8px; max-height: 150px; overflow-y: auto; 
            background: rgba(0,0,0,0.3); padding: 10px; border-radius: 5px;
        }
        .tag-choice {
            padding: 4px 10px; border: 1px solid #555; border-radius: 15px; cursor: pointer; font-size: 0.8rem;
        }
        .tag-choice.selected { background: #ffcc66; color: #000; border-color: #fff; }

        /* --- ã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ¼ãƒ‰ (ãƒ­ãƒ“ãƒ¼ç”¨) --- */
        .quest-board {
            max-width: 800px; margin: 60px auto 20px auto; 
            background: rgba(30, 20, 10, 0.9); border: 2px solid #8b4513; border-radius: 10px;
            padding: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }
        .quest-title { font-size: 1.1rem; color: #ffcc66; border-bottom: 1px solid #5c3a21; padding-bottom: 5px; margin-bottom: 10px; }
        .quest-item { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px dashed #5c3a21; }
        .quest-item.completed { color: #888; text-decoration: line-through; }
        .quest-reward { color: #4caf50; font-weight: bold; font-size: 0.9rem; }

        /* --- UIãƒ‘ãƒ¼ãƒ„ --- */
        .search-area-centered { display: flex; gap: 15px; justify-content: center; margin-bottom: 20px; flex-wrap: wrap; }
        .search-input-base { padding: 12px; background: rgba(30,30,30,0.95); border: 1px solid #ffcc66; color: #fff; border-radius: 5px; width: 300px; }
        .tag-list { display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; max-width: 1000px; margin: 0 auto 30px auto; }
        .search-tag { background: rgba(40, 40, 40, 0.8); border: 1px solid #666; padding: 6px 14px; border-radius: 20px; cursor: pointer; transition: 0.2s; font-size: 0.85rem; }
        .search-tag:hover, .search-tag.active { background: #ffcc66; color: #000; text-shadow: none; border-color: #fff; }

        /* ã‚²ãƒ¼ãƒ ã‚«ãƒ¼ãƒ‰ */
        .game-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; max-width: 1100px; margin: 0 auto; }
        .game-card {
            background-color: rgba(20, 20, 20, 0.95); border: 1px solid #444; border-radius: 12px; overflow: hidden; text-decoration: none; color: inherit; transition: 0.2s; display: flex; flex-direction: column; position: relative;
        }
        .game-card.highlight { border: 2px solid #ffcc66; box-shadow: 0 0 15px rgba(255, 204, 102, 0.3); } /* ãŠæ°—ã«å…¥ã‚Šå¼·èª¿ */
        .game-card:hover { transform: translateY(-5px); border-color: #ffcc66; }
        .game-thumb { width: 100%; aspect-ratio: 16/9; object-fit: cover; background: #000; }
        .card-body { padding: 15px; flex-grow: 1; display: flex; flex-direction: column; }
        
        .spec-table { width: 100%; font-size: 0.85rem; border-collapse: collapse; margin-top: 10px; }
        .spec-table td { padding: 4px 0; border-bottom: 1px solid #333; }
        .spec-value { text-align: right; font-weight: bold; }
        .time-sugu { color: #4caf50; } .time-futsu { color: #ffeb3b; } .time-nagai { color: #f44336; }
        .chat-enter-btn { display: block; width: 100%; text-align: center; background: #4caf50; color: #fff; padding: 10px 0; margin-top: 15px; border-radius: 5px; font-weight: bold; border: none; cursor: pointer; }
        .chat-enter-btn:hover { background: #66bb6a; }

        .card-footer { margin-top: auto; padding-top: 15px; display: flex; align-items: center; justify-content: space-between; }
        .action-icons { display: flex; gap: 10px; }
        .rpg-btn {
            width: 36px; height: 36px; background: #333; border: 2px solid #555; border-radius: 8px;
            display: flex; align-items: center; justify-content: center; cursor: pointer; position: relative; transition: 0.2s;
        }
        .rpg-btn:hover { border-color: #ffcc66; background: #444; }
        .rpg-btn svg { width: 20px; height: 20px; fill: #aaa; transition: 0.2s; }
        .rpg-btn:hover svg { fill: #ffcc66; filter: drop-shadow(0 0 5px rgba(255,204,102,0.8)); }
        .rpg-btn::after {
            content: attr(data-tooltip); position: absolute; bottom: 120%; left: 50%; transform: translateX(-50%);
            background: rgba(0,0,0,0.9); border: 1px solid #ffcc66; color: #ffcc66;
            padding: 5px 10px; font-size: 0.75rem; white-space: nowrap; border-radius: 4px;
            opacity: 0; pointer-events: none; transition: 0.2s; z-index: 10;
        }
        .rpg-btn:hover::after { opacity: 1; bottom: 130%; }
        .price-text { text-align: right; font-weight: bold; color: #ffcc66; font-size: 1.1rem; }

        /* ãƒãƒ£ãƒƒãƒˆ */
        #lobby-chat-view { display: none; animation: fadeIn 0.4s; }
        .chat-container { background: rgba(15, 15, 15, 0.9); border: 1px solid #333; border-radius: 8px; height: 450px; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; }
        .chat-msg { display: flex; gap: 12px; align-items: flex-start; }
        .chat-avatar { width: 40px; height: 40px; background: #333; border-radius: 50%; flex-shrink: 0; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; overflow: hidden; }
        .chat-avatar img { width: 100%; height: 100%; object-fit: cover; }
        .chat-content { display: flex; flex-direction: column; }
        .chat-info { display: flex; align-items: baseline; gap: 10px; margin-bottom: 2px; }
        .chat-user { font-weight: bold; color: #ffcc66; }
        .chat-time { font-size: 0.75rem; color: #888; }
        .chat-text { color: #eee; line-height: 1.4; word-break: break-all; }
        .chat-input-area { margin-top: 15px; display: flex; gap: 10px; }
        .chat-input-area input { flex-grow: 1; padding: 12px; background: #1a1a1a; border: 1px solid #444; color: #fff; border-radius: 5px; }
        .action-btn { padding: 10px 25px; background: #ffcc66; color: #000; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; }

        /* ã‹ã°ã‚“ */
        .bag-tabs { display: flex; justify-content: center; gap: 20px; margin-bottom: 30px; }
        .bag-tab-btn {
            background: rgba(30,30,30,0.8); border: 1px solid #555; color: #aaa; padding: 10px 30px; 
            border-radius: 30px; cursor: pointer; font-size: 1.1rem; transition: 0.3s;
        }
        .bag-tab-btn.active, .bag-tab-btn:hover { background: #ffcc66; color: #000; border-color: #fff; font-weight: bold; }
        .bag-content-section { display: none; animation: fadeIn 0.4s; }
        .bag-content-section.active { display: block; }
        .empty-msg { text-align: center; color: #666; margin-top: 50px; }

        /* ã‚¿ãƒ­ãƒƒãƒˆ */
        .tarot-grid-top { display: grid; grid-template-columns: repeat(5, 1fr); gap: 20px; max-width: 1000px; margin: 0 auto; }
        .tarot-grid-bottom { display: flex; justify-content: center; margin-top: 20px; }
        .tarot-card-item { cursor: pointer; transition: 0.3s; width: 160px; }
        .tarot-card-item img { width: 100%; border-radius: 8px; }

        h2 { color: #ffcc66; text-shadow: 0 0 10px rgba(255, 204, 102, 0.6); margin-bottom: 5px; }
        .flash-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: #fff; pointer-events: none; opacity: 0; z-index: 400; }
        .flash-active { animation: flashAnim 0.8s ease-out forwards; }
        @keyframes flashAnim { 0% { opacity: 0; } 10% { opacity: 1; } 100% { opacity: 0; } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    </style>
</head>
<body>

    <div class="bg-container">
        <div class="bg-image"></div>
    </div>

    <div class="clock-display" id="clock">00:00:00</div>

    <div id="profile-btn" class="profile-trigger" onclick="toggleProfileModal()" style="display:block;">
        <img src="https://placehold.jp/3d4070/ffffff/150x150.png?text=User" id="main-profile-icon" class="profile-icon-img frame-normal">
    </div>

    <div id="profile-modal" class="modal-overlay" onclick="if(event.target===this) toggleProfileModal()">
        <div class="modal-content">
            <span class="modal-close" onclick="toggleProfileModal()">&times;</span>
            <h2 style="text-align:center; margin-bottom:20px;">æ—…äººã®è¨¼ (ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«)</h2>
            
            <div class="level-container">
                <div class="level-text">Lv. <span id="level-val">1</span></div>
                <div class="xp-bar-container">
                    <div id="xp-bar-fill" class="xp-bar-fill"></div>
                    <div id="xp-bar-text" class="xp-bar-text">0 / 100 XP</div>
                </div>
            </div>

            <div class="profile-section">
                <h3>1. ã‚¢ã‚¤ã‚³ãƒ³ç”»åƒå¤‰æ›´</h3>
                <div style="display:flex; gap:15px; align-items:center;">
                    <img src="" id="preview-icon" class="profile-icon-img" style="width:80px; height:80px;">
                    <input type="file" id="icon-upload" accept="image/*" onchange="uploadIcon(this)">
                </div>
            </div>

            <div class="profile-section">
                <h3>2. ãƒ•ãƒ¬ãƒ¼ãƒ å¤‰æ›´</h3>
                <select id="frame-select" onchange="changeFrame(this.value)" style="padding:10px; background:#333; color:#fff; border:1px solid #555;">
                    <option value="frame-normal">æ—…äººã®é‰„æ  (ãƒãƒ¼ãƒãƒ«)</option>
                    <option value="frame-silver">é¨å£«ã®éŠ€æ  (ã‚·ãƒ«ãƒãƒ¼)</option>
                    <option value="frame-gold">ç‹å®¶ã®é‡‘æ  (ã‚´ãƒ¼ãƒ«ãƒ‰)</option>
                </select>
            </div>

            <div class="profile-section" style="border-bottom:none;">
                <h3>3. ãŠæ°—ã«å…¥ã‚Šã‚¿ã‚° (æœ€å¤§3ã¤)</h3>
                <p style="font-size:0.8rem; color:#aaa; margin-bottom:10px;">é¸ã‚“ã ã‚¿ã‚°ã®ã‚²ãƒ¼ãƒ ã¯æ¤œç´¢çµæœã‚„ãƒ­ãƒ“ãƒ¼ã§å„ªå…ˆè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
                <div id="fav-tag-list" class="tag-selector"></div>
            </div>
        </div>
    </div>

    <div id="main-view" class="container">
        <header>
            <img src="title.png" alt="ãŸã³ã³ã¨ãŸã¡ã®ã•ã‹ã°" class="site-logo">
        </header>

        <nav class="main-menu">
            <div class="menu-item" onclick="openScreen('tarot-screen')">
                <div class="icon-bg"><img src="tarot_0.png" class="menu-icon"></div>
                <div class="menu-label">ã†ã‚“ã‚ã„ã®ã¿ã¡ã³ã<br>(ãŠã™ã™ã‚ã‚²ãƒ¼ãƒ è¨ºæ–­)</div>
            </div>
            <div class="menu-item" onclick="openScreen('search-screen')">
                <div class="icon-bg"><img src="search_0.png" class="menu-icon"></div>
                <div class="menu-label">ã™ã„ã—ã‚‡ã†ã®ã—ã‚“ãŸã<br>(ã‚²ãƒ¼ãƒ æ¤œç´¢)</div>
            </div>
            <div class="menu-item" onclick="openScreen('book-screen')">
                <div class="icon-bg"><img src="book_0.png" class="menu-icon"></div>
                <div class="menu-label">ã¼ã†ã‘ã‚“ã®ã—ã‚‡<br>(ã‚²ãƒ¼ãƒ ãƒ¬ãƒ“ãƒ¥ãƒ¼)</div>
            </div>
            <div class="menu-item" onclick="openScreen('lobby-screen')">
                <div class="icon-bg"><img src="lobby_0.png" class="menu-icon"></div>
                <div class="menu-label">ã¤ã©ã„ã®ã‘ã„ã˜ã°ã‚“<br>ï¼ˆãƒ‘ãƒ¼ãƒ†ã‚£å‹Ÿé›†æ²ç¤ºæ¿ï¼‰</div>
            </div>
            <div class="menu-item" onclick="openScreen('bag-screen')">
                <div class="icon-bg"><img src="bag_0.png" class="menu-icon"></div>
                <div class="menu-label">ã‹ã°ã‚“<br>ï¼ˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼†<br>ã‚¦ã‚£ãƒƒã‚·ãƒ¥ãƒªã‚¹ãƒˆï¼‰</div>
            </div>
        </nav>
    </div>

    <div id="tarot-screen" class="sub-screen">
        <div class="screen-bg"></div>
        <div class="nav-header">
            <button class="nav-btn" onclick="backToMenu()">é…’å ´ã«æˆ»ã‚‹</button>
            <button class="nav-btn" onclick="goBack('tarot')">æˆ»ã‚‹</button>
        </div>
        <div class="flash-overlay" id="flash-effect"></div>
        <div class="container">
            <div id="tarot-board" style="text-align: center;">
                <h2>å°ãã®æ‰‹æœ­ã‚’é¸ã³ãŸã¾ãˆ</h2>
                <div class="tarot-grid-top" id="grid-top"></div>
                <div class="tarot-grid-bottom" id="grid-bottom"></div>
            </div>
            <div id="tarot-result-area" style="display:none; text-align: center;">
                <h2 id="result-card-name"></h2>
                <p id="result-card-genre" style="margin-bottom:30px; color:#aaa;"></p>
                <div id="tarot-result-list" class="game-grid"></div>
                <button class="nav-btn" style="margin:40px auto;" onclick="resetTarot()">åˆ¥ã®ã‚«ãƒ¼ãƒ‰ã‚’é¸ã¶</button>
            </div>
        </div>
    </div>

    <div id="search-screen" class="sub-screen">
        <div class="screen-bg"></div>
        <div class="nav-header">
            <button class="nav-btn" onclick="backToMenu()">é…’å ´ã«æˆ»ã‚‹</button>
            <button class="nav-btn" onclick="backToMenu()">æˆ»ã‚‹</button>
        </div>
        <div class="container">
            <div style="text-align:center; padding: 40px;"><h2>æ°´æ™¶ãŒç¤ºã™å±æ€§ã§æ¢ã™</h2></div>
            <div class="search-area-centered">
                <input type="text" id="search-name-input" class="search-input-base" placeholder="åå‰ã§çµã‚Šè¾¼ã¿ (ã‹ãªå¯¾å¿œ)..." oninput="filterSearch()">
            </div>
            <div id="search-tags-container" class="tag-list"></div>
            <div id="search-result-list" class="game-grid"></div>
        </div>
    </div>

    <div id="book-screen" class="sub-screen">
        <div class="screen-bg"></div>
        <div class="nav-header">
            <button class="nav-btn" onclick="backToMenu()">é…’å ´ã«æˆ»ã‚‹</button>
            <button class="nav-btn" onclick="backToMenu()">æˆ»ã‚‹</button>
        </div>
        <div class="container">
            <div style="text-align:center; padding: 40px;"><h2>ã¼ã†ã‘ã‚“ã®ã—ã‚‡</h2></div>
            <p style="text-align: center;">ç·¨çº‚ä¸­...</p>
        </div>
    </div>

    <div id="lobby-screen" class="sub-screen">
        <div class="screen-bg"></div>
        <div class="nav-header">
            <button class="nav-btn" onclick="backToMenu()">é…’å ´ã«æˆ»ã‚‹</button>
            <button class="nav-btn" onclick="goBack('lobby')">æˆ»ã‚‹</button>
        </div>
        <div class="container">
            <div class="quest-board">
                <div class="quest-title">ğŸ“œ ã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ¼ãƒ‰ (æœ¬æ—¥ã®ä¾é ¼)</div>
                <div id="quest-1" class="quest-item"><span>1. ãƒãƒ£ãƒƒãƒˆã§ç™ºè¨€ã›ã‚ˆ</span><span class="quest-reward">å ±é…¬: 50 XP</span></div>
                <div id="quest-2" class="quest-item"><span>2. é‹å‘½ã®å°ã(å ã„)ã‚’å—ã‘ã‚ˆ</span><span class="quest-reward">å ±é…¬: 30 XP</span></div>
                <div id="quest-3" class="quest-item"><span>3. å†’é™ºã®æ›¸ã‚’é–‹ã‘</span><span class="quest-reward">å ±é…¬: 20 XP</span></div>
            </div>

            <div id="lobby-entrance-view">
                <div style="text-align:center; padding: 40px;"><h2>ã¤ã©ã„ã®ã‘ã„ã˜ã°ã‚“</h2><p>ãƒ­ãƒ“ãƒ¼ã‚’é¸ã‚“ã§å‚åŠ ã›ã‚ˆ</p></div>
                <div class="search-area-centered">
                    <input type="text" id="lobby-name-input" class="search-input-base" placeholder="åå‰ã§çµã‚Šè¾¼ã¿ (ã‹ãªå¯¾å¿œ)..." oninput="filterLobby()">
                </div>
                <div id="lobby-tags-container" class="tag-list"></div>
                <div id="lobby-list" class="game-grid"></div>
            </div>

            <div id="lobby-chat-view">
                <div class="lobby-header">
                    <h3 id="current-lobby-name">ã‚²ãƒ¼ãƒ å</h3>
                </div>
                <div id="chat-window" class="chat-container"></div>
                <div class="chat-input-area">
                    <input type="text" id="chat-user" placeholder="åç„¡ã—ã•ã‚“" style="width:120px; flex-grow:0;">
                    <input type="text" id="chat-msg" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›..." onkeydown="if(event.key==='Enter') sendMessage()">
                    <button class="action-btn" onclick="sendMessage()">é€ä¿¡</button>
                </div>
            </div>
        </div>
    </div>

    <div id="bag-screen" class="sub-screen">
        <div class="screen-bg"></div>
        <div class="nav-header">
            <button class="nav-btn" onclick="backToMenu()">é…’å ´ã«æˆ»ã‚‹</button>
            <button class="nav-btn" onclick="backToMenu()">æˆ»ã‚‹</button>
        </div>
        <div class="container">
            <div style="text-align:center; padding: 40px;"><h2>æ—…äººã®ã‚«ãƒãƒ³</h2></div>
            <div class="bag-tabs">
                <div class="bag-tab-btn active" onclick="switchBagTab('owned')">æ‰€æŒæ¸ˆã¿</div>
                <div class="bag-tab-btn" onclick="switchBagTab('wish')">æ¬²ã—ã„</div>
                <div class="bag-tab-btn" onclick="switchBagTab('fav')">ãŠæ°—ã«å…¥ã‚Š</div>
            </div>
            <div id="bag-owned" class="bag-content-section active"><div class="empty-msg">ã¾ã ç™»éŒ²ã•ã‚ŒãŸã‚²ãƒ¼ãƒ ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</div></div>
            <div id="bag-wish" class="bag-content-section"><div class="empty-msg" id="bag-wish-list">æ¬²ã—ã„ã‚‚ã®ãƒªã‚¹ãƒˆã¯ç©ºã§ã™ã€‚</div></div>
            <div id="bag-fav" class="bag-content-section"><div class="empty-msg">ãŠæ°—ã«å…¥ã‚Šã®ã‚²ãƒ¼ãƒ ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚</div></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, onChildAdded, off } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // â˜…Firebaseè¨­å®š
        const firebaseConfig = {
            apiKey: "AIzaSyA8MD33z8M7bamr69zNTW8AFHnz6bzz0sU",
            authDomain: "tabibito-chat-142a6.firebaseapp.com",
            databaseURL: "https://tabibito-chat-142a6-default-rtdb.firebaseio.com/",
            projectId: "tabibito-chat-142a6",
            storageBucket: "tabibito-chat-142a6.firebasestorage.app",
            messagingSenderId: "683972511288",
            appId: "1:683972511288:web:e9755aef35664f256948cd",
            measurementId: "G-R6LECTN01H"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        window.sendMessage = sendMessage;
        window.enterLobby = enterLobby;
        window.exitLobby = exitLobby;

        let currentLobbyId = null;
        let unsubscribe = null;

        function enterLobby(id) {
            const game = gamesData.find(g => g.imageId == id);
            openScreen('lobby-screen');
            document.getElementById('lobby-entrance-view').style.display = 'none';
            document.getElementById('lobby-chat-view').style.display = 'block';
            document.getElementById('current-lobby-name').innerText = `ã€ãƒ­ãƒ“ãƒ¼ã€‘${game.title}`;
            const chatWin = document.getElementById('chat-window');
            chatWin.innerHTML = '';
            currentLobbyId = id;
            const chatRef = ref(db, 'chats/' + id);
            unsubscribe = onChildAdded(chatRef, (snapshot) => {
                const data = snapshot.val();
                renderMessage(data);
            });
        }

        function exitLobby() {
            if (currentLobbyId) {
                const chatRef = ref(db, 'chats/' + currentLobbyId);
                off(chatRef);
            }
            currentLobbyId = null;
            document.getElementById('lobby-entrance-view').style.display = 'block';
            document.getElementById('lobby-chat-view').style.display = 'none';
        }

        function sendMessage() {
            if (!currentLobbyId) return;
            const user = document.getElementById('chat-user').value || "åç„¡ã—ã•ã‚“";
            const msg = document.getElementById('chat-msg').value;
            if(!msg) return;

            const now = new Date();
            const timeStr = `${now.getFullYear()}/${now.getMonth()+1}/${now.getDate()} ${now.getHours()}:${now.getMinutes().toString().padStart(2,'0')}`;

            const chatRef = ref(db, 'chats/' + currentLobbyId);
            push(chatRef, { user: user, message: msg, time: timeStr });
            document.getElementById('chat-msg').value = "";
            
            // â˜…ã‚¯ã‚¨ã‚¹ãƒˆ: ãƒãƒ£ãƒƒãƒˆé€ä¿¡
            checkQuest(1);
        }

        function renderMessage(data) {
            const win = document.getElementById('chat-window');
            const div = document.createElement('div');
            div.className = 'chat-msg';
            
            div.innerHTML = `
                <div class="chat-avatar">${data.user.charAt(0)}</div>
                <div class="chat-content">
                    <div class="chat-info"><span class="chat-user">${data.user}</span><span class="chat-time">${data.time}</span></div>
                    <div class="chat-text">${data.message}</div>
                </div>
            `;
            win.appendChild(div);
            win.scrollTop = win.scrollHeight;
        }
    </script>

    <script>
        // --- ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ ---
        const gamesData = [
            { title: "Apex Legends", kana: "ãˆãƒ¼ãºã£ãã™ã‚Œã˜ã‡ã‚“ãš", imageId: "1172470", price: 0, sizeGB: 75, crossplay: true, vc: true, oneCopy: false, tags: ["FPS", "ãƒãƒˆãƒ«ãƒ­ã‚¤ãƒ¤ãƒ«", "å¾©æ´»ãƒ»é€†è»¢", "å¯¾æˆ¦"] },
            { title: "Among Us", kana: "ã‚ã‚‚ã‚“ãã‚ã™", imageId: "945360", price: 580, sizeGB: 1, crossplay: true, vc: true, oneCopy: false, tags: ["æ­£ä½“éš åŒ¿", "å”åŠ›"] },
            { title: "Counter-Strike 2", kana: "ã‹ã†ã‚“ãŸãƒ¼ã™ã¨ã‚‰ã„ã", imageId: "730", price: 0, sizeGB: 60, crossplay: false, vc: true, oneCopy: false, tags: ["FPS", "å¯¾æˆ¦"] },
            { title: "The Finals", kana: "ã–ãµãã„ãªã‚‹ãš", imageId: "2073850", price: 0, sizeGB: 20, crossplay: true, vc: true, oneCopy: false, tags: ["FPS", "å¯¾æˆ¦", "ç ´å£Š"] },
            { title: "Dota 2", kana: "ã©ãƒ¼ãŸ2", imageId: "570", price: 0, sizeGB: 45, crossplay: false, vc: true, oneCopy: false, tags: ["ã‚¹ãƒˆãƒ©ãƒ†ã‚¸ãƒ¼", "å¯¾æˆ¦"] },
            { title: "PUBG: BATTLEGROUNDS", kana: "ã±ã¶ã˜ãƒ¼", imageId: "578080", price: 0, sizeGB: 40, crossplay: true, vc: true, oneCopy: false, tags: ["FPS", "ãƒãƒˆãƒ«ãƒ­ã‚¤ãƒ¤ãƒ«", "å¯¾æˆ¦"] },
            { title: "Destiny 2", kana: "ã§ã™ã¦ãƒã«ãƒ¼2", imageId: "1085660", price: 0, sizeGB: 100, crossplay: true, vc: true, oneCopy: false, tags: ["FPS", "ãƒ¬ã‚¤ãƒ‰", "è‚²æˆ"] },
            { title: "Warframe", kana: "ã†ã‰ãƒ¼ãµã‚Œãƒ¼ã‚€", imageId: "230410", price: 0, sizeGB: 50, crossplay: true, vc: true, oneCopy: false, tags: ["ã‚¢ã‚¯ã‚·ãƒ§ãƒ³", "å”åŠ›", "è‚²æˆ"] },
            { title: "Team Fortress 2", kana: "ã¡ãƒ¼ã‚€ãµã‰ãƒ¼ã¨ã‚Œã™2", imageId: "440", price: 0, sizeGB: 15, crossplay: false, vc: true, oneCopy: false, tags: ["FPS", "å¯¾æˆ¦"] },
            { title: "Rust", kana: "ã‚‰ã™ã¨", imageId: "252490", price: 5200, sizeGB: 25, crossplay: true, vc: true, oneCopy: false, tags: ["ã‚µãƒã‚¤ãƒãƒ«", "å¯¾æˆ¦", "æ”»åŸæˆ¦"] },
            { title: "War Thunder", kana: "ã†ã‰ãƒ¼ã•ã‚“ã ãƒ¼", imageId: "236390", price: 0, sizeGB: 45, crossplay: true, vc: false, oneCopy: false, tags: ["å¯¾æˆ¦", "ã‚¹ãƒãƒ¼ãƒ„"] },
            { title: "Naraka: Bladepoint", kana: "ãªã‚‰ã‹", imageId: "1203220", price: 0, sizeGB: 35, crossplay: true, vc: true, oneCopy: false, tags: ["å¯¾æˆ¦", "ãƒãƒˆãƒ«ãƒ­ã‚¤ãƒ¤ãƒ«"] },
            { title: "Monster Hunter: World", kana: "ã‚‚ã‚“ã¯ã‚“ã‚ãƒ¼ã‚‹ã©", imageId: "582010", price: 2990, sizeGB: 52, crossplay: false, vc: false, oneCopy: false, tags: ["ãƒ¬ã‚¤ãƒ‰", "å”åŠ›", "ã‚¢ã‚¯ã‚·ãƒ§ãƒ³"] },
            { title: "Monster Hunter Rise", kana: "ã‚‚ã‚“ã¯ã‚“ã‚‰ã„ãš", imageId: "1446780", price: 3990, sizeGB: 23, crossplay: false, vc: false, oneCopy: false, tags: ["ãƒ¬ã‚¤ãƒ‰", "å”åŠ›", "ã‚¢ã‚¯ã‚·ãƒ§ãƒ³"] },
            { title: "Palworld", kana: "ã±ã‚‹ã‚ãƒ¼ã‚‹ã©", imageId: "1623730", price: 3400, sizeGB: 40, crossplay: true, vc: false, oneCopy: false, tags: ["è‚²æˆ", "ã‚µãƒã‚¤ãƒãƒ«", "ã‚ªãƒ¼ãƒ—ãƒ³ãƒ¯ãƒ¼ãƒ«ãƒ‰"] },
            { title: "Dead by Daylight", kana: "ã§ã£ã©ã°ã„ã ã„ã‚‰ã„ã¨", imageId: "381210", price: 1980, sizeGB: 50, crossplay: true, vc: false, oneCopy: false, tags: ["éå¯¾ç§°å¯¾æˆ¦", "ãƒ›ãƒ©ãƒ¼", "å¯¾æˆ¦"] },
            { title: "Left 4 Dead 2", kana: "ã‚Œãµã¨ãµã‰ãƒ¼ã§ã£ã©2", imageId: "550", price: 1200, sizeGB: 13, crossplay: false, vc: false, oneCopy: false, tags: ["ã‚¾ãƒ³ãƒ“", "å”åŠ›", "FPS"] },
            { title: "Terraria", kana: "ã¦ã‚‰ã‚Šã‚", imageId: "105600", price: 1200, sizeGB: 0.5, crossplay: true, vc: false, oneCopy: false, tags: ["ã‚¯ãƒ©ãƒ•ãƒˆ", "æ¢ç´¢", "2D"] },
            { title: "Stardew Valley", kana: "ã™ãŸãƒ¼ã§ã‚…ãƒ¼ã°ã‚Œãƒ¼", imageId: "413150", price: 1480, sizeGB: 1, crossplay: true, vc: false, oneCopy: false, tags: ["ã‚¯ãƒ©ãƒ•ãƒˆ", "è‚²æˆ"] },
            { title: "Valheim", kana: "ã°ã‚‹ã¸ã„ã‚€", imageId: "892970", price: 2050, sizeGB: 2, crossplay: true, vc: false, oneCopy: false, tags: ["ã‚µãƒã‚¤ãƒãƒ«", "ã‚¯ãƒ©ãƒ•ãƒˆ", "æ¢ç´¢"] },
            { title: "Grand Theft Auto V", kana: "ãã‚‰ã‚“ã©ã›ãµã¨ãŠãƒ¼ã¨", imageId: "271590", price: 4850, sizeGB: 100, crossplay: false, vc: true, oneCopy: false, tags: ["ã‚ªãƒ¼ãƒ—ãƒ³ãƒ¯ãƒ¼ãƒ«ãƒ‰", "å¯¾æˆ¦", "ãƒ¬ãƒ¼ã‚¹"] },
            { title: "Tom Clancy's Rainbow Six Siege", kana: "ã‚Œã„ã‚“ã¼ãƒ¼ã—ã£ãã™ã—ãƒ¼ã˜", imageId: "359550", price: 2600, sizeGB: 60, crossplay: true, vc: true, oneCopy: false, tags: ["FPS", "å¯¾æˆ¦", "ã‚¹ãƒˆãƒ©ãƒ†ã‚¸ãƒ¼"] },
            { title: "Baldur's Gate 3", kana: "ã°ã‚‹ã ãƒ¼ãšã’ãƒ¼ã¨3", imageId: "1086940", price: 8500, sizeGB: 150, crossplay: true, vc: false, oneCopy: false, tags: ["RPG", "å”åŠ›", "ã‚¹ãƒˆãƒ©ãƒ†ã‚¸ãƒ¼"] },
            { title: "Unturned", kana: "ã‚ã‚“ãŸãƒ¼ã‚“ã©", imageId: "304930", price: 0, sizeGB: 4, crossplay: false, vc: true, oneCopy: false, tags: ["ã‚µãƒã‚¤ãƒãƒ«", "ã‚¾ãƒ³ãƒ“", "ã‚¯ãƒ©ãƒ•ãƒˆ"] },
            { title: "7 Days to Die", kana: "ã›ã¶ã‚“ã§ã„ãšã¨ã…ã ã„", imageId: "251570", price: 5980, sizeGB: 15, crossplay: true, vc: false, oneCopy: false, tags: ["ã‚µãƒã‚¤ãƒãƒ«", "ã‚¾ãƒ³ãƒ“", "ã‚¯ãƒ©ãƒ•ãƒˆ"] },
            { title: "ARK: Survival Ascended", kana: "ã‚ãƒ¼ã", imageId: "2399830", price: 6000, sizeGB: 80, crossplay: true, vc: true, oneCopy: false, tags: ["ã‚µãƒã‚¤ãƒãƒ«", "è‚²æˆ", "ã‚ªãƒ¼ãƒ—ãƒ³ãƒ¯ãƒ¼ãƒ«ãƒ‰"] },
            { title: "Don't Starve Together", kana: "ã©ã‚“ã™ãŸ", imageId: "322330", price: 1480, sizeGB: 3, crossplay: false, vc: false, oneCopy: false, tags: ["ã‚µãƒã‚¤ãƒãƒ«", "å”åŠ›", "ã‚¯ãƒ©ãƒ•ãƒˆ"] },
            { title: "Phasmophobia", kana: "ãµããšã‚‚ãµã‰ã³ã‚", imageId: "739630", price: 1420, sizeGB: 20, crossplay: true, vc: true, oneCopy: false, tags: ["ãƒ›ãƒ©ãƒ¼", "æ¢ç´¢", "å”åŠ›"] },
            { title: "Lethal Company", kana: "ã‚Šãƒ¼ã•ã‚‹ã‹ã‚“ã±ã«ãƒ¼", imageId: "1966720", price: 1200, sizeGB: 1, crossplay: false, vc: true, oneCopy: false, tags: ["ãƒ›ãƒ©ãƒ¼", "æ¢ç´¢", "å”åŠ›"] },
            { title: "Content Warning", kana: "ã“ã‚“ã¦ã‚“ã¨ã‚ãƒ¼ã«ã‚“ã", imageId: "2881650", price: 920, sizeGB: 2, crossplay: false, vc: true, oneCopy: false, tags: ["ãƒ›ãƒ©ãƒ¼", "ãƒ¡ã‚¿ãƒãƒ¼ã‚¹", "å”åŠ›"] },
            { title: "Sea of Thieves", kana: "ã—ãƒ¼ãŠã¶ã—ãƒ¼ã¶ã™", imageId: "1172620", price: 4200, sizeGB: 50, crossplay: true, vc: true, oneCopy: false, tags: ["ã‚ªãƒ¼ãƒ—ãƒ³ãƒ¯ãƒ¼ãƒ«ãƒ‰", "æ¢ç´¢", "å¯¾æˆ¦"] },
            { title: "Project Zomboid", kana: "ã·ã‚ã˜ã‡ãã¨ãã‚“ã¼ã„ã©", imageId: "108600", price: 2300, sizeGB: 5, crossplay: false, vc: false, oneCopy: false, tags: ["ã‚µãƒã‚¤ãƒãƒ«", "ã‚ªãƒ¼ãƒ—ãƒ³ãƒ¯ãƒ¼ãƒ«ãƒ‰"] },
            { title: "Raft", kana: "ã‚‰ãµã¨", imageId: "648800", price: 1980, sizeGB: 10, crossplay: false, vc: false, oneCopy: false, tags: ["ã‚µãƒã‚¤ãƒãƒ«", "ã‚¯ãƒ©ãƒ•ãƒˆ"] },
            { title: "The Forest", kana: "ã–ãµã‰ã‚Œã™ã¨", imageId: "242760", price: 2050, sizeGB: 5, crossplay: false, vc: false, oneCopy: false, tags: ["ã‚µãƒã‚¤ãƒãƒ«", "ãƒ›ãƒ©ãƒ¼"] },
            { title: "Sons of the Forest", kana: "ã•ã‚“ãšãŠã¶ã–ãµã‰ã‚Œã™ã¨", imageId: "1326470", price: 3400, sizeGB: 20, crossplay: false, vc: true, oneCopy: false, tags: ["ã‚µãƒã‚¤ãƒãƒ«", "ãƒ›ãƒ©ãƒ¼", "ã‚¯ãƒ©ãƒ•ãƒˆ"] },
            { title: "Garry's Mod", kana: "ãã‚ƒã‚Šãƒ¼ãšã‚‚ã£ã©", imageId: "4000", price: 1200, sizeGB: 5, crossplay: false, vc: true, oneCopy: false, tags: ["ãƒ¡ã‚¿ãƒãƒ¼ã‚¹", "ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹"] },
            { title: "Deep Rock Galactic", kana: "ã§ãƒãƒ¼ã·ã‚ã£ã", imageId: "548430", price: 3000, sizeGB: 6, crossplay: true, vc: true, oneCopy: false, tags: ["å”åŠ›", "FPS", "ãƒ¬ã‚¤ãƒ‰"] },
            { title: "Euro Truck Simulator 2", kana: "ã‚†ãƒ¼ã‚ã¨ã‚‰ã£ã", imageId: "227300", price: 2400, sizeGB: 12, crossplay: false, vc: false, oneCopy: false, tags: ["ãƒ¬ãƒ¼ã‚¹", "ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«"] },
            { title: "VRChat", kana: "ã¶ã„ã‚ãƒ¼ã‚‹ã¡ã‚ƒã£ã¨", imageId: "438100", price: 0, sizeGB: 1, crossplay: true, vc: true, oneCopy: false, tags: ["ãƒ¡ã‚¿ãƒãƒ¼ã‚¹", "ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«"] },
            { title: "Dead Island 2", kana: "ã§ã£ã©ã‚ã„ã‚‰ã‚“ã©2", imageId: "934700", price: 7700, sizeGB: 70, crossplay: true, vc: true, oneCopy: false, tags: ["ã‚¾ãƒ³ãƒ“", "å”åŠ›"] },
            { title: "It Takes Two", kana: "ã„ã£ã¨ã¦ã„ãã™ã¤ãƒ¼", imageId: "1426210", price: 4300, sizeGB: 45, crossplay: true, vc: true, oneCopy: true, tags: ["å”åŠ›", "ãƒ‘ã‚ºãƒ«"] },
            { title: "Cuphead", kana: "ã‹ã£ã·ã¸ã£ã©", imageId: "268910", price: 1980, sizeGB: 4, crossplay: false, vc: false, oneCopy: true, tags: ["å”åŠ›", "ã‚¢ã‚¯ã‚·ãƒ§ãƒ³"] },
            { title: "Castle Crashers", kana: "ãã‚ƒã£ã™ã‚‹ãã‚‰ã£ã—ã‚…", imageId: "204360", price: 1700, sizeGB: 1, crossplay: true, vc: false, oneCopy: true, tags: ["å”åŠ›", "ã‚¢ã‚¯ã‚·ãƒ§ãƒ³"] },
            { title: "BattleBit Remastered", kana: "ã°ã¨ã‚‹ã³ã£ã¨", imageId: "671860", price: 1500, sizeGB: 2, crossplay: false, vc: true, oneCopy: false, tags: ["FPS", "å¯¾æˆ¦"] },
            { title: "PAYDAY 2", kana: "ãºã„ã§ã„2", imageId: "218620", price: 1200, sizeGB: 80, crossplay: false, vc: false, oneCopy: false, tags: ["å”åŠ›", "FPS", "å¼·ç›—"] },
            { title: "PAYDAY 3", kana: "ãºã„ã§ã„3", imageId: "1272080", price: 4600, sizeGB: 50, crossplay: true, vc: true, oneCopy: false, tags: ["å”åŠ›", "FPS", "å¼·ç›—"] },
            { title: "Borderlands 2", kana: "ã¼ãƒ¼ã ãƒ¼ã‚‰ã‚“ãš2", imageId: "49520", price: 2000, sizeGB: 20, crossplay: false, vc: false, oneCopy: false, tags: ["FPS", "å”åŠ›", "RPG"] },
            { title: "Borderlands 3", kana: "ã¼ãƒ¼ã ãƒ¼ã‚‰ã‚“ãš3", imageId: "397540", price: 7000, sizeGB: 75, crossplay: true, vc: false, oneCopy: false, tags: ["FPS", "å”åŠ›", "RPG"] },
            { title: "Sid Meier's Civilization VI", kana: "ã—ã³ã‚‰ã„ãœãƒ¼ã—ã‚‡ã‚“", imageId: "289070", price: 7000, sizeGB: 12, crossplay: true, vc: false, oneCopy: false, tags: ["ã‚¹ãƒˆãƒ©ãƒ†ã‚¸ãƒ¼", "å¯¾æˆ¦"] },
            { title: "Hearts of Iron IV", kana: "ã¯ãƒ¼ã¤ãŠã¶ã‚ã„ã‚ã‚“", imageId: "394360", price: 5400, sizeGB: 5, crossplay: false, vc: false, oneCopy: false, tags: ["ã‚¹ãƒˆãƒ©ãƒ†ã‚¸ãƒ¼", "å¯¾æˆ¦"] },
            { title: "Stellaris", kana: "ã™ã¦ã‚‰ã‚Šã™", imageId: "281990", price: 4400, sizeGB: 10, crossplay: true, vc: false, oneCopy: false, tags: ["ã‚¹ãƒˆãƒ©ãƒ†ã‚¸ãƒ¼", "å®‡å®™"] },
            { title: "Factorio", kana: "ãµããã¨ã‚ŠãŠ", imageId: "427520", price: 4000, sizeGB: 3, crossplay: false, vc: false, oneCopy: false, tags: ["ã‚¯ãƒ©ãƒ•ãƒˆ", "ã‚¹ãƒˆãƒ©ãƒ†ã‚¸ãƒ¼"] },
            { title: "Satisfactory", kana: "ã•ã¦ãƒã™ãµããã¨ã‚Šãƒ¼", imageId: "526870", price: 3400, sizeGB: 15, crossplay: false, vc: false, oneCopy: false, tags: ["ã‚¯ãƒ©ãƒ•ãƒˆ", "æ¢ç´¢"] },
            { title: "Overcooked! 2", kana: "ãŠãƒ¼ã°ãƒ¼ãã£ã2", imageId: "728880", price: 2570, sizeGB: 3, crossplay: true, vc: true, oneCopy: true, tags: ["å”åŠ›", "ãƒ‘ã‚ºãƒ«", "ãƒªã‚ºãƒ "] },
            { title: "PlateUp!", kana: "ã·ã‚Œãƒ¼ã¨ã‚ã£ã·", imageId: "1599600", price: 2300, sizeGB: 2, crossplay: false, vc: false, oneCopy: true, tags: ["å”åŠ›", "ã‚¹ãƒˆãƒ©ãƒ†ã‚¸ãƒ¼"] },
            { title: "Human: Fall Flat", kana: "ã²ã‚…ãƒ¼ã¾ã‚“ãµã‰ãƒ¼ã‚‹ãµã‚‰ã£ã¨", imageId: "477160", price: 2050, sizeGB: 2, crossplay: true, vc: false, oneCopy: true, tags: ["ãƒ‘ã‚ºãƒ«", "å”åŠ›"] },
            { title: "Golf With Your Friends", kana: "ã”ã‚‹ãµ", imageId: "431240", price: 1520, sizeGB: 4, crossplay: true, vc: false, oneCopy: true, tags: ["ã‚¹ãƒãƒ¼ãƒ„", "ãƒ¬ãƒ¼ã‚¹"] },
            { title: "Golf It!", kana: "ã”ã‚‹ãµã„ã£ã¨", imageId: "571740", price: 920, sizeGB: 3, crossplay: false, vc: false, oneCopy: false, tags: ["ã‚¹ãƒãƒ¼ãƒ„", "ãƒ¬ãƒ¼ã‚¹"] },
            { title: "Ultimate Chicken Horse", kana: "ã‚ã‚‹ã¦ãƒã‚ã£ã¨ã¡ãã‚“ã»ãƒ¼ã™", imageId: "386940", price: 1480, sizeGB: 2, crossplay: true, vc: false, oneCopy: true, tags: ["å¯¾æˆ¦", "ãƒ‘ã‚ºãƒ«"] },
            { title: "Pummel Party", kana: "ã±ã‚ã‚‹ã±ãƒ¼ã¦ãƒ", imageId: "880940", price: 1520, sizeGB: 2, crossplay: false, vc: true, oneCopy: true, tags: ["å¯¾æˆ¦", "ã‚«ã‚¸ãƒ"] },
            { title: "Party Animals", kana: "ã±ãƒ¼ã¦ãƒã‚ã«ã¾ã‚‹ãš", imageId: "1260320", price: 2100, sizeGB: 10, crossplay: true, vc: true, oneCopy: false, tags: ["å¯¾æˆ¦", "ç‰©ç†æ¼”ç®—"] },
            { title: "Gang Beasts", kana: "ãã‚ƒã‚“ãã³ãƒ¼ã™ã¨", imageId: "285900", price: 1980, sizeGB: 2, crossplay: true, vc: false, oneCopy: true, tags: ["å¯¾æˆ¦", "ç‰©ç†æ¼”ç®—"] },
            { title: "Rubber Bandits", kana: "ã‚‰ã°ãƒ¼ã°ã‚“ã§ãƒã£ã¤", imageId: "1206610", price: 1100, sizeGB: 2, crossplay: true, vc: false, oneCopy: true, tags: ["å¯¾æˆ¦", "ç‰©ç†æ¼”ç®—"] },
            { title: "Stick Fight: The Game", kana: "ã™ã¦ãƒã£ããµãã„ã¨", imageId: "674940", price: 520, sizeGB: 0.5, crossplay: false, vc: false, oneCopy: true, tags: ["å¯¾æˆ¦"] },
            { title: "Brawlhalla", kana: "ã¶ã‚ã†ã‚‹ã¯ã‚‰", imageId: "291550", price: 0, sizeGB: 1, crossplay: true, vc: false, oneCopy: false, tags: ["å¯¾æˆ¦", "ã‚¢ã‚¯ã‚·ãƒ§ãƒ³"] },
            { title: "Goose Goose Duck", kana: "ããƒ¼ã™ããƒ¼ã™ã ã£ã", imageId: "1568590", price: 0, sizeGB: 1, crossplay: true, vc: true, oneCopy: false, tags: ["æ­£ä½“éš åŒ¿", "ã‚¯ã‚¤ã‚º"] },
            { title: "SCP: Secret Laboratory", kana: "ãˆã™ã—ãƒ¼ã´ãƒ¼", imageId: "700330", price: 0, sizeGB: 4, crossplay: false, vc: true, oneCopy: false, tags: ["ãƒ›ãƒ©ãƒ¼", "å¯¾æˆ¦"] },
            { title: "Barotrauma", kana: "ã°ã‚ã¨ã‚‰ã†ã¾", imageId: "602960", price: 4200, sizeGB: 1, crossplay: false, vc: true, oneCopy: false, tags: ["ã‚µãƒã‚¤ãƒãƒ«", "å”åŠ›", "æ¢ç´¢"] },
            { title: "We Were Here Forever", kana: "ã†ãƒãƒ¼ã‚ãƒ¼ã²ã‚ãµã‰ãƒ¼ãˆã°ãƒ¼", imageId: "1341290", price: 1980, sizeGB: 25, crossplay: true, vc: true, oneCopy: false, tags: ["ãƒ‘ã‚ºãƒ«", "å”åŠ›"] },
            { title: "Portal 2", kana: "ã½ãƒ¼ãŸã‚‹2", imageId: "620", price: 1200, sizeGB: 8, crossplay: false, vc: true, oneCopy: true, tags: ["ãƒ‘ã‚ºãƒ«", "å”åŠ›"] },
            { title: "Bread & Fred", kana: "ã¶ã‚Œã£ã©ã‚ã‚“ã©ãµã‚Œã£ã©", imageId: "1607680", price: 1700, sizeGB: 1, crossplay: false, vc: false, oneCopy: true, tags: ["å”åŠ›", "ãƒ‘ã‚ºãƒ«"] },
            { title: "Biped", kana: "ã°ã„ãºã£ã©", imageId: "1071870", price: 1520, sizeGB: 2, crossplay: true, vc: false, oneCopy: true, tags: ["å”åŠ›", "ãƒ‘ã‚ºãƒ«"] },
            { title: "Unrailed!", kana: "ã‚ã‚“ã‚Œã„ã‚‹ã©", imageId: "1016920", price: 2350, sizeGB: 2, crossplay: true, vc: false, oneCopy: true, tags: ["å”åŠ›", "ãƒ¬ãƒ¼ã‚¹"] },
            { title: "Heave Ho", kana: "ã²ãƒ¼ã¶ã»ãƒ¼", imageId: "905340", price: 1150, sizeGB: 1, crossplay: false, vc: false, oneCopy: true, tags: ["å”åŠ›", "ç‰©ç†æ¼”ç®—"] },
            { title: "PICO PARK", kana: "ã´ã“ã±ãƒ¼ã", imageId: "1509960", price: 520, sizeGB: 0.2, crossplay: false, vc: false, oneCopy: true, tags: ["å”åŠ›", "ãƒ‘ã‚ºãƒ«"] },
            { title: "Keep Talking and Nobody Explodes", kana: "ããƒ¼ã·ã¨ãƒ¼ãã‚“ã", imageId: "341800", price: 1500, sizeGB: 1, crossplay: false, vc: true, oneCopy: true, tags: ["ãƒ‘ã‚ºãƒ«", "å”åŠ›"] },
            { title: "Tabletop Simulator", kana: "ã¦ãƒ¼ã¶ã‚‹ã¨ã£ã·", imageId: "286160", price: 1980, sizeGB: 3, crossplay: false, vc: true, oneCopy: true, tags: ["ã‚«ã‚¸ãƒ", "ãƒ‘ã‚ºãƒ«", "å”åŠ›"] },
            { title: "Core Keeper", kana: "ã“ã‚ããƒ¼ã±ãƒ¼", imageId: "1621690", price: 2300, sizeGB: 1, crossplay: true, vc: false, oneCopy: false, tags: ["ã‚¯ãƒ©ãƒ•ãƒˆ", "æ¢ç´¢"] },
            { title: "Enshrouded", kana: "ãˆã‚“ã—ã‚…ã‚‰ã†ã©", imageId: "1203620", price: 3400, sizeGB: 30, crossplay: false, vc: false, oneCopy: false, tags: ["ã‚µãƒã‚¤ãƒãƒ«", "ã‚ªãƒ¼ãƒ—ãƒ³ãƒ¯ãƒ¼ãƒ«ãƒ‰", "ã‚¯ãƒ©ãƒ•ãƒˆ"] },
            { title: "Smalland: Survive the Wilds", kana: "ã™ã‚‚ãƒ¼ã‚‰ã‚“ã©", imageId: "768200", price: 3400, sizeGB: 20, crossplay: false, vc: false, oneCopy: false, tags: ["ã‚µãƒã‚¤ãƒãƒ«", "æ¢ç´¢"] },
            { title: "Grounded", kana: "ãã‚‰ã†ã‚“ã§ã£ã©", imageId: "962130", price: 4200, sizeGB: 8, crossplay: true, vc: true, oneCopy: false, tags: ["ã‚µãƒã‚¤ãƒãƒ«", "ã‚¯ãƒ©ãƒ•ãƒˆ"] },
            { title: "No Man's Sky", kana: "ã®ãƒ¼ã¾ã‚“ãšã™ã‹ã„", imageId: "275850", price: 6500, sizeGB: 15, crossplay: true, vc: true, oneCopy: false, tags: ["ã‚ªãƒ¼ãƒ—ãƒ³ãƒ¯ãƒ¼ãƒ«ãƒ‰", "æ¢ç´¢", "ã‚¯ãƒ©ãƒ•ãƒˆ"] },
            { title: "Astroneer", kana: "ã‚ã™ã¨ã‚ã«ãƒ¼ã‚", imageId: "361420", price: 3000, sizeGB: 4, crossplay: true, vc: false, oneCopy: false, tags: ["æ¢ç´¢", "ã‚¯ãƒ©ãƒ•ãƒˆ"] },
            { title: "Risk of Rain 2", kana: "ã‚Šã™ããŠã¶ã‚Œã„ã‚“2", imageId: "632360", price: 2570, sizeGB: 4, crossplay: true, vc: false, oneCopy: false, tags: ["ã‚¢ã‚¯ã‚·ãƒ§ãƒ³", "ãƒ¬ã‚¤ãƒ‰"] },
            { title: "Gunfire Reborn", kana: "ãŒã‚“ãµãã„ã‚", imageId: "1217060", price: 2050, sizeGB: 4, crossplay: true, vc: true, oneCopy: false, tags: ["å”åŠ›", "FPS"] },
            { title: "Crab Game", kana: "ãã‚‰ã¶ã’ãƒ¼ã‚€", imageId: "1782210", price: 0, sizeGB: 2, crossplay: false, vc: true, oneCopy: false, tags: ["å¯¾æˆ¦", "ãƒ‘ã‚ºãƒ«"] },
            { title: "Omega Strikers", kana: "ãŠã‚ãŒã™ã¨ã‚‰ã„ã‹ãƒ¼ãš", imageId: "1869590", price: 0, sizeGB: 4, crossplay: true, vc: false, oneCopy: false, tags: ["ã‚¹ãƒãƒ¼ãƒ„", "å¯¾æˆ¦"] },
            { title: "Street Fighter 6", kana: "ã™ã¨ã‚Šãƒ¼ã¨ãµãã„ãŸãƒ¼6", imageId: "1364780", price: 7990, sizeGB: 60, crossplay: true, vc: false, oneCopy: false, tags: ["å¯¾æˆ¦", "ã‚¹ãƒãƒ¼ãƒ„"] },
            { title: "Tekken 8", kana: "ã¦ã£ã‘ã‚“8", imageId: "1778820", price: 9680, sizeGB: 100, crossplay: true, vc: false, oneCopy: false, tags: ["å¯¾æˆ¦", "ã‚¹ãƒãƒ¼ãƒ„"] },
            { title: "Remnant II", kana: "ã‚Œã‚€ãªã‚“ã¨2", imageId: "1282100", price: 5900, sizeGB: 80, crossplay: true, vc: true, oneCopy: false, tags: ["å”åŠ›", "ãƒ¬ã‚¤ãƒ‰"] },
            { title: "Warhammer 40,000: Darktide", kana: "ã ãƒ¼ããŸã„ã©", imageId: "1361210", price: 5200, sizeGB: 50, crossplay: true, vc: true, oneCopy: false, tags: ["å”åŠ›", "FPS", "ãƒ¬ã‚¤ãƒ‰"] },
            { title: "Warhammer: Vermintide 2", kana: "ã°ãƒ¼ã¿ã‚“ãŸã„ã©2", imageId: "552500", price: 3500, sizeGB: 65, crossplay: false, vc: false, oneCopy: false, tags: ["å”åŠ›", "ã‚¢ã‚¯ã‚·ãƒ§ãƒ³", "ãƒ¬ã‚¤ãƒ‰"] },
            { title: "Killing Floor 2", kana: "ãã‚Šã‚“ããµã‚ã‚2", imageId: "232090", price: 2980, sizeGB: 80, crossplay: true, vc: false, oneCopy: false, tags: ["ã‚¾ãƒ³ãƒ“", "FPS", "å”åŠ›"] },
            { title: "Back 4 Blood", kana: "ã°ã£ããµã‰ãƒ¼ã¶ã‚‰ã£ã©B4B", imageId: "924970", price: 8580, sizeGB: 40, crossplay: true, vc: true, oneCopy: false, tags: ["ã‚¾ãƒ³ãƒ“", "å”åŠ›", "FPS"] },
            { title: "Aliens: Fireteam Elite", kana: "ãˆã„ã‚Šã‚ã‚“", imageId: "1549970", price: 3100, sizeGB: 30, crossplay: true, vc: true, oneCopy: false, tags: ["å”åŠ›", "FPS"] },
            { title: "The Outlast Trials", kana: "ã‚ã†ã¨ã‚‰ã™ã¨", imageId: "1304930", price: 3400, sizeGB: 30, crossplay: true, vc: true, oneCopy: false, tags: ["ãƒ›ãƒ©ãƒ¼", "å”åŠ›"] },
            { title: "Devour", kana: "ã§ã‚”ãã†ã‚", imageId: "1274570", price: 620, sizeGB: 8, crossplay: false, vc: true, oneCopy: false, tags: ["ãƒ›ãƒ©ãƒ¼", "å”åŠ›"] },
            { title: "Pacify", kana: "ã±ã—ãµãã„", imageId: "967050", price: 620, sizeGB: 5, crossplay: false, vc: true, oneCopy: false, tags: ["ãƒ›ãƒ©ãƒ¼", "å”åŠ›"] },
            { title: "Among Us VR", kana: "ã‚ã‚‚ã‚“ãã‚ã™VR", imageId: "1849900", price: 1200, sizeGB: 2, crossplay: true, vc: true, oneCopy: false, tags: ["æ­£ä½“éš åŒ¿", "VR"] },
            { title: "Abiotic Factor", kana: "ã‚ã°ã„ãŠã¦ãƒã£ã", imageId: "427410", price: 3000, sizeGB: 10, crossplay: false, vc: true, oneCopy: false, tags: ["ã‚µãƒã‚¤ãƒãƒ«", "ã‚¯ãƒ©ãƒ•ãƒˆ"] },
            { title: "Chivalry 2", kana: "ã—ã±ã‚‹ã‚Šãƒ¼2", imageId: "1824220", price: 4100, sizeGB: 20, crossplay: true, vc: false, oneCopy: false, tags: ["å¯¾æˆ¦", "æ”»åŸæˆ¦"] },
            { title: "Mordhau", kana: "ã‚‚ã‚‹ã ã†", imageId: "629760", price: 3400, sizeGB: 40, crossplay: false, vc: false, oneCopy: false, tags: ["å¯¾æˆ¦", "æ”»åŸæˆ¦"] }
        ];

        // --- ãƒ­ã‚¸ãƒƒã‚¯ ---
        function updateClock() {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
        }
        setInterval(updateClock, 1000);
        updateClock();

        function getInstallTime(size) {
            if (size <= 3) return { text: "ã™ã", class: "time-sugu" };
            if (size <= 10) return { text: "ãµã¤ã†", class: "time-futsu" };
            return { text: "ãªãŒã„", class: "time-nagai" };
        }

        // --- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ»ã‚¯ã‚¨ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç®¡ç† (LocalStorage) ---
        let userProfile = {
            icon: "https://placehold.jp/3d4070/ffffff/150x150.png?text=User",
            frame: "frame-normal",
            favTags: [],
            xp: 0,
            quests: { 1: false, 2: false, 3: false }
        };

        function loadProfile() {
            const saved = localStorage.getItem("tabibito_profile");
            if (saved) {
                userProfile = JSON.parse(saved);
            }
            updateProfileUI();
            updateQuestBoardUI();
        }

        function saveProfile() {
            localStorage.setItem("tabibito_profile", JSON.stringify(userProfile));
            updateProfileUI();
            updateQuestBoardUI();
        }

        function updateProfileUI() {
            const mainIcon = document.getElementById("main-profile-icon");
            const previewIcon = document.getElementById("preview-icon");
            
            mainIcon.src = userProfile.icon;
            previewIcon.src = userProfile.icon;
            mainIcon.className = `profile-icon-img ${userProfile.frame}`;
            
            // ãƒ¬ãƒ™ãƒ«è¨ˆç®—: XP/100ã§ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ— (Lv = floor(XP/100) + 1)
            const level = Math.floor(userProfile.xp / 100) + 1;
            const currentLevelXP = userProfile.xp % 100; // æ¬¡ã®ãƒ¬ãƒ™ãƒ«ã¾ã§ã®é€²æ—
            
            document.getElementById("level-val").innerText = level;
            document.getElementById("xp-bar-fill").style.width = `${currentLevelXP}%`;
            document.getElementById("xp-bar-text").innerText = `${currentLevelXP} / 100 XP`;

            document.getElementById("frame-select").value = userProfile.frame;

            const list = document.getElementById("fav-tag-list");
            list.innerHTML = "";
            const allTags = [...new Set(gamesData.flatMap(g => g.tags))];
            allTags.forEach(tag => {
                const sp = document.createElement("span");
                sp.className = "tag-choice" + (userProfile.favTags.includes(tag) ? " selected" : "");
                sp.innerText = tag;
                sp.onclick = () => toggleFavTag(tag);
                list.appendChild(sp);
            });
        }

        function toggleFavTag(tag) {
            if (userProfile.favTags.includes(tag)) {
                userProfile.favTags = userProfile.favTags.filter(t => t !== tag);
            } else {
                if (userProfile.favTags.length >= 3) {
                    alert("ãŠæ°—ã«å…¥ã‚Šã‚¿ã‚°ã¯3ã¤ã¾ã§ã§ã™");
                    return;
                }
                userProfile.favTags.push(tag);
            }
            saveProfile();
        }

        function uploadIcon(input) {
            const file = input.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                userProfile.icon = e.target.result;
                saveProfile();
            };
            reader.readAsDataURL(file);
        }

        function changeFrame(val) {
            userProfile.frame = val;
            saveProfile();
        }

        function toggleProfileModal() {
            const modal = document.getElementById("profile-modal");
            const btn = document.getElementById("profile-btn");
            if (modal.style.display === "flex") {
                modal.style.display = "none";
                btn.style.display = "block";
            } else {
                modal.style.display = "flex";
            }
        }

        // --- ã‚¯ã‚¨ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ  ---
        function checkQuest(questId) {
            if (userProfile.quests[questId]) return;

            let xpGain = 0;
            if (questId === 1) xpGain = 50;
            if (questId === 2) xpGain = 30;
            if (questId === 3) xpGain = 20;

            userProfile.xp += xpGain;
            userProfile.quests[questId] = true;
            saveProfile();
            alert(`ã‚¯ã‚¨ã‚¹ãƒˆé”æˆï¼ ${xpGain} XPã‚’ç²å¾—ã—ã¾ã—ãŸï¼`);
        }

        function updateQuestBoardUI() {
            for (let i = 1; i <= 3; i++) {
                const el = document.getElementById(`quest-${i}`);
                if (el) {
                    if (userProfile.quests[i]) {
                        el.classList.add("completed");
                        if(!el.innerText.includes("(æ¸ˆ)")) el.innerHTML = el.innerHTML.replace("</span>", " (æ¸ˆ)</span>");
                    } else {
                        el.classList.remove("completed");
                    }
                }
            }
        }

        // --- ã‚²ãƒ¼ãƒ ã‚«ãƒ¼ãƒ‰ç”Ÿæˆ ---
        function createGameCard(game, type) {
            const time = getInstallTime(game.sizeGB);
            const priceText = game.price === 0 ? "åŸºæœ¬ç„¡æ–™" : `Â¥${game.price.toLocaleString()}`;
            
            const isFav = game.tags.some(t => userProfile.favTags.includes(t));
            const highlightClass = isFav ? " highlight" : "";

            let mainLinkAttr = `href="https://store.steampowered.com/app/${game.imageId}/" target="_blank"`;
            if (type === 'lobby') {
                mainLinkAttr = `href="javascript:void(0)" onclick="enterLobby('${game.imageId}')"`;
            }

            return `
                <div class="game-card${highlightClass}">
                    <a ${mainLinkAttr} style="text-decoration:none; color:inherit; display:block;">
                        <img src="https://cdn.akamai.steamstatic.com/steam/apps/${game.imageId}/header.jpg" class="game-thumb" onerror="this.src='https://placehold.jp/24/333333/ffffff/300x150.png?text=No+Image'">
                    </a>
                    <div class="card-body">
                        <div style="font-weight:bold; font-size:1.1rem; color:#fff; margin-bottom:8px;">${game.title}</div>
                        <div style="margin-bottom:10px;">${game.tags.map(t => {
                            const style = userProfile.favTags.includes(t) ? "background:#ffcc66; color:#000;" : "background:#333;";
                            return `<span style="display:inline-block; padding:2px 6px; font-size:0.75rem; border-radius:3px; margin:2px; ${style}">${t}</span>`;
                        }).join('')}</div>
                        
                        <table class="spec-table">
                            <tr><td>ã‚¯ãƒ­ã‚¹ãƒ—ãƒ¬ã‚¤</td><td class="spec-value">${game.crossplay ? 'â­•' : 'âŒ'}</td></tr>
                            <tr><td>ã‚½ãƒ•ãƒˆ1æœ¬ã§å…¨å“¡ãƒ—ãƒ¬ã‚¤å¯èƒ½</td><td class="spec-value">${game.oneCopy ? 'â­•' : 'âŒ'}</td></tr>
                            <tr><td>ãƒœã‚¤ãƒãƒ£å¿…é ˆ</td><td class="spec-value">${game.vc ? 'â­•' : 'âŒ'}</td></tr>
                            <tr><td>ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</td><td class="spec-value ${time.class}">${time.text}</td></tr>
                        </table>

                        <div class="card-footer">
                            <div class="action-icons">
                                <div class="rpg-btn" data-tooltip="ã‚¦ã‚£ãƒƒã‚·ãƒ¥ãƒªã‚¹ãƒˆã«è¿½åŠ " onclick="addToWishlist('${game.title}')">
                                    <svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                                </div>
                                <div class="rpg-btn" data-tooltip="ä»Šã™ããƒãƒ£ãƒƒãƒˆã«å‚åŠ " onclick="enterLobby('${game.imageId}')">
                                    <svg viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></svg>
                                </div>
                            </div>
                            <div class="price-text">${priceText}</div>
                        </div>
                    </div>
                </div>`;
        }

        function addToWishlist(title) {
            const list = document.getElementById('bag-wish-list');
            if(list.innerText === "æ¬²ã—ã„ã‚‚ã®ãƒªã‚¹ãƒˆã¯ç©ºã§ã™ã€‚") {
                list.innerText = "";
            }
            const item = document.createElement('div');
            item.style.padding = "5px";
            item.style.borderBottom = "1px solid #333";
            item.innerText = `ãƒ»${title}`;
            list.appendChild(item);
            alert(`${title} ã‚’ã‚¦ã‚£ãƒƒã‚·ãƒ¥ãƒªã‚¹ãƒˆã«è¿½åŠ ã—ã¾ã—ãŸï¼`);
        }

        function openScreen(id) {
            document.getElementById('main-view').style.display = 'none';
            document.getElementById(id).style.display = 'block';
            
            if(id === 'book-screen') {
                checkQuest(3);
            }

            if(id === 'tarot-screen') initTarot();
            if(id === 'search-screen') initSearchScreen();
            if(id === 'lobby-screen') {
                initLobbyScreen();
            }
        }
        function backToMenu() {
            document.querySelectorAll('.sub-screen').forEach(s => s.style.display = 'none');
            document.getElementById('main-view').style.display = 'block';
        }
        function goBack(context) {
            if(context === 'tarot') {
                if(document.getElementById('tarot-result-area').style.display === 'block') resetTarot(); else backToMenu();
            } else if(context === 'lobby') {
                if(document.getElementById('lobby-chat-view').style.display === 'block') exitLobby(); else backToMenu();
            }
        }

        function switchBagTab(tabId) {
            document.querySelectorAll('.bag-tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.bag-content-section').forEach(s => s.classList.remove('active'));
            const tabs = { 'owned': 0, 'wish': 1, 'fav': 2 };
            document.querySelectorAll('.bag-tab-btn')[tabs[tabId]].classList.add('active');
            document.getElementById(`bag-${tabId}`).classList.add('active');
        }

        function initTarot() {
            const top = document.getElementById('grid-top'), bottom = document.getElementById('grid-bottom');
            if(top.innerHTML) return;
            const definitions = [
                { id: 1, name: "I. é­”è¡“å¸«", genre: "ã‚¯ãƒ©ãƒ•ãƒˆ" }, { id: 2, name: "II. å¥³æ•™çš‡", genre: "æ­£ä½“éš åŒ¿" },
                { id: 3, name: "III. å¥³å¸", genre: "è‚²æˆ" }, { id: 4, name: "IV. çš‡å¸", genre: "ã‚¹ãƒˆãƒ©ãƒ†ã‚¸ãƒ¼" },
                { id: 5, name: "V. æ•™çš‡", genre: "ã‚¯ã‚¤ã‚º" }, { id: 6, name: "VI.æ‹äºº", genre: "å”åŠ›" },
                { id: 7, name: "VII. æˆ¦è»Š", genre: "ãƒ¬ãƒ¼ã‚¹" }, { id: 8, name: "VIII. åŠ›", genre: "ãƒ¬ã‚¤ãƒ‰" },
                { id: 9, name: "IX. éš è€…", genre: "æ¢ç´¢" }, { id: 10, name: "X. é‹å‘½ã®è¼ª", genre: "ã‚«ã‚¸ãƒ" },
                { id: 11, name: "XI. æ­£ç¾©", genre: "å¯¾æˆ¦" }, { id: 12, name: "XII. åŠã‚‹ã•ã‚ŒãŸç”·", genre: "ãƒ‘ã‚ºãƒ«" },
                { id: 13, name: "XIII. æ­»ç¥", genre: "ã‚µãƒã‚¤ãƒãƒ«" }, { id: 14, name: "XIV. ç¯€åˆ¶", genre: "ãƒªã‚ºãƒ " },
                { id: 15, name: "XV. æ‚ªé­”", genre: "éå¯¾ç§°å¯¾æˆ¦" }, { id: 16, name: "XVI. å¡”", genre: "æ”»åŸæˆ¦" },
                { id: 17, name: "XVII. æ˜Ÿ", genre: "ã‚ªãƒ¼ãƒ—ãƒ³ãƒ¯ãƒ¼ãƒ«ãƒ‰" }, { id: 18, name: "XVIII. æœˆ", genre: "ãƒ›ãƒ©ãƒ¼" },
                { id: 19, name: "XIX. å¤ªé™½", genre: "ã‚¹ãƒãƒ¼ãƒ„" }, { id: 20, name: "XX. å¯©åˆ¤", genre: "å¾©æ´»ãƒ»é€†è»¢" },
                { id: 21, name: "XXI. ä¸–ç•Œ", genre: "ãƒ¡ã‚¿ãƒãƒ¼ã‚¹" }
            ];
            definitions.forEach(c => {
                const html = `<div class="tarot-card-item" onclick="onCardClick('${c.genre}', '${c.name}')"><img src="tarot_${c.id}.png"></div>`;
                if(c.id <= 20) top.innerHTML += html; else bottom.innerHTML += html;
            });
        }
        function onCardClick(genre, name) {
            const flash = document.getElementById('flash-effect');
            flash.classList.add('flash-active');
            
            checkQuest(2);

            setTimeout(() => {
                flash.classList.remove('flash-active');
                document.getElementById('tarot-board').style.display = 'none';
                document.getElementById('result-card-name').innerText = name;
                document.getElementById('result-card-genre').innerText = `å°ã‹ã‚ŒãŸã‚¸ãƒ£ãƒ³ãƒ«: ${genre}`;
                const matched = gamesData.filter(g => g.tags.includes(genre));
                document.getElementById('tarot-result-list').innerHTML = matched.map(g => createGameCard(g, 'default')).join('');
                document.getElementById('tarot-result-area').style.display = 'block';
            }, 500);
        }
        function resetTarot() { document.getElementById('tarot-result-area').style.display = 'none'; document.getElementById('tarot-board').style.display = 'block'; }

        function sortGamesByFav(games) {
            return games.sort((a, b) => {
                const aFav = a.tags.some(t => userProfile.favTags.includes(t));
                const bFav = b.tags.some(t => userProfile.favTags.includes(t));
                return (bFav === aFav) ? 0 : bFav ? 1 : -1;
            });
        }

        let currentSearchTag = "";
        function initSearchScreen() {
            const container = document.getElementById('search-tags-container');
            if(container.innerHTML === "") {
                const allTags = [...new Set(gamesData.flatMap(g => g.tags))];
                container.innerHTML = allTags.map(t => `<div class="search-tag" onclick="toggleSearchTag('${t}', this)">${t}</div>`).join('');
                filterSearch();
            }
        }
        function toggleSearchTag(tag, elem) {
            if(currentSearchTag === tag) {
                currentSearchTag = "";
                elem.classList.remove('active');
            } else {
                currentSearchTag = tag;
                document.querySelectorAll('#search-tags-container .search-tag').forEach(e => e.classList.remove('active'));
                elem.classList.add('active');
            }
            filterSearch();
        }
        function filterSearch() {
            const nameVal = document.getElementById('search-name-input').value.toLowerCase();
            const list = document.getElementById('search-result-list');
            let results = gamesData.filter(g => {
                const nameMatch = !nameVal || g.title.toLowerCase().includes(nameVal) || (g.kana && g.kana.includes(nameVal));
                const tagMatch = !currentSearchTag || g.tags.includes(currentSearchTag);
                return nameMatch && tagMatch;
            });
            results = sortGamesByFav(results);
            list.innerHTML = results.map(g => createGameCard(g, 'default')).join('');
        }

        let currentLobbyTag = "";
        function initLobbyScreen() {
            const container = document.getElementById('lobby-tags-container');
            if(container.innerHTML === "") {
                const allTags = [...new Set(gamesData.flatMap(g => g.tags))];
                container.innerHTML = allTags.map(t => `<div class="search-tag" onclick="toggleLobbyTag('${t}', this)">${t}</div>`).join('');
                filterLobby();
            }
        }
        function toggleLobbyTag(tag, elem) {
            if(currentLobbyTag === tag) {
                currentLobbyTag = "";
                elem.classList.remove('active');
            } else {
                currentLobbyTag = tag;
                document.querySelectorAll('#lobby-tags-container .search-tag').forEach(e => e.classList.remove('active'));
                elem.classList.add('active');
            }
            filterLobby();
        }
        function filterLobby() {
            const nameVal = document.getElementById('lobby-name-input').value.toLowerCase();
            const list = document.getElementById('lobby-list');
            let results = gamesData.filter(g => {
                const nameMatch = !nameVal || g.title.toLowerCase().includes(nameVal) || (g.kana && g.kana.includes(nameVal));
                const tagMatch = !currentLobbyTag || g.tags.includes(currentLobbyTag);
                return nameMatch && tagMatch;
            });
            results = sortGamesByFav(results);
            list.innerHTML = results.map(g => createGameCard(g, 'lobby')).join('');
        }

        window.onload = loadProfile;
    </script>
</body>
</html>
